{
  "rules": {
    ".read": false,
    ".write": false,
    
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "user_profiles": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('user_profiles').child($uid).child('privacy').child('profileVisible').val() == true)",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "user_preferences": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "user_projects": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "user_activities": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "test": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    
    "community_doubts": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "subject", "difficulty", "isResolved", "authorId"]
    },
    
    "community_answers": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "doubtId", "authorId"]
    },
    
    "doubt_answers": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "doubtId", "userId"]
    },
    
    "reports": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "contentType", "status"]
    },
    
    "leaderboard": {
      ".read": "auth != null",
      ".write": false,
      ".indexOn": ["totalPoints", "level"]
    },
    
    "doubts": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "userId", "category", "status"]
    },
    
    "feedback": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["timestamp", "userId", "type"]
    },
    
    "project_feedbacks": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$projectId": {
        ".read": "auth != null",
        ".write": "auth != null",
        "$feedbackId": {
          ".read": "auth != null",
          ".write": "auth != null",
          "replies": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$replyId": {
              ".read": "auth != null",
              ".write": "auth != null && (!data.exists() || auth.uid == data.child('userId').val())",
              ".validate": "newData.exists() && newData.hasChildren(['userId', 'reply', 'timestamp']) && auth.uid == newData.child('userId').val()"
            }
          }
        }
      },
      ".indexOn": ["timestamp", "userId", "projectId", "category"]
    },
    
    "project_feedback_stats": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    
    "user_progress": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      },
      ".indexOn": ["lastUpdated", "progressPercentage", "totalActivities"]
    },
    
    "profile_images_metadata": {
      "$uid": {
        ".read": "auth != null",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    "quiz_questions": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["subject", "topic", "difficulty"]
    },
    
    "quiz_results": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      },
      ".indexOn": ["userId", "subject", "completedAt", "score"]
    },
    
    "video_history": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      },
      ".indexOn": ["userId", "videoId", "lastWatchedAt", "category", "isCompleted"]
    },
    
    "video_watch_sessions": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      },
      ".indexOn": ["userId", "videoId", "startTime", "endTime"]
    },
    
    "user_fcm_tokens": {
      ".read": "auth != null",
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid",
        ".validate": "newData.hasChildren(['token', 'updatedAt'])"
      },
      ".indexOn": ["updatedAt", "platform"]
    },
    
    "notifications": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$notificationId": {
        ".read": "auth != null",
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['recipientId', 'title', 'body', 'timestamp'])"
      },
      ".indexOn": ["recipientId", "timestamp", "type", "isRead"]
    },
    
    "projects": {
      ".read": true,
      ".write": "auth != null",
      "$projectId": {
        ".read": true,
        ".write": "auth != null && (auth.uid == data.child('authorId').val() || !data.exists())",
        ".validate": "newData.hasChildren(['title', 'description', 'authorId', 'timestamp'])"
      },
      ".indexOn": ["timestamp", "category", "difficulty", "isPublic", "authorId"]
    },
    
    "project_ideas": {
      ".read": true,
      ".write": "auth != null",
      "$ideaId": {
        ".read": true,
        ".write": "auth != null && (auth.uid == data.child('authorId').val() || !data.exists())",
        ".validate": "newData.hasChildren(['title', 'description', 'authorId', 'createdAt'])"
      },
      ".indexOn": ["createdAt", "category", "difficulty", "status", "authorId"]
    }
  }
}
